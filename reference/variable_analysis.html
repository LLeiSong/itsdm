<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function to evaluate relative importance of each variable. — variable_analysis • itsdm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to evaluate relative importance of each variable. — variable_analysis"><meta name="description" content="Evaluate relative importance of each variable within the model
using the following methods:
Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables
SHapley Additive exPlanations (SHAP) according to Shapley values

"><meta property="og:description" content="Evaluate relative importance of each variable within the model
using the following methods:
Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables
SHapley Additive exPlanations (SHAP) according to Shapley values

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">itsdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction_of_itsdm.html">Introduction of itsdm with a virtual species</a></li>
    <li><a class="dropdown-item" href="../articles/itsdm_example.html">Using itsdm to a real species: Africa savanna elephant</a></li>
    <li><a class="dropdown-item" href="../articles/shap_application.html">Applications of Shapley values on SDM explanation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LLeiSong/itsdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Function to evaluate relative importance of each variable.</h1>
      <small class="dont-index">Source: <a href="https://github.com/LLeiSong/itsdm/blob/main/R/variable_analysis.R" class="external-link"><code>R/variable_analysis.R</code></a></small>
      <div class="d-none name"><code>variable_analysis.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Evaluate relative importance of each variable within the model
using the following methods:</p><ul><li><p>Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables</p></li>
<li><p>SHapley Additive exPlanations (SHAP) according to Shapley values</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">variable_analysis</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">pts_occ</span>,</span>
<span>  pts_occ_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">variables</span>,</span>
<span>  shap_nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  visualize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>(<code>isolation_forest</code>) The extended isolation forest SDM. It could be
the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="isotree_po.html">isotree_po</a></code>.</p></dd>


<dt id="arg-pts-occ">pts_occ<a class="anchor" aria-label="anchor" href="#arg-pts-occ"></a></dt>
<dd><p>(<code>sf</code>) The <code>sf</code> style table that
include training occurrence locations.</p></dd>


<dt id="arg-pts-occ-test">pts_occ_test<a class="anchor" aria-label="anchor" href="#arg-pts-occ-test"></a></dt>
<dd><p>(<code>sf</code>, or <code>NULL</code>) The <code>sf</code> style
table that include occurrence locations of test.
If <code>NULL</code>, it would be set the same as <code>var_occ</code>. The default is <code>NULL</code>.</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>(<code>stars</code>) The <code>stars</code> of environmental variables. It should have
multiple <code>attributes</code> instead of <code>dims</code>. If you have <code>raster</code> object instead, you
could use <code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></code> to convert it to <code>stars</code> or use
<code><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></code> directly read source data as a <code>stars</code>.</p></dd>


<dt id="arg-shap-nsim">shap_nsim<a class="anchor" aria-label="anchor" href="#arg-shap-nsim"></a></dt>
<dd><p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation of
function <code><a href="https://bgreenwell.github.io/fastshap/reference/explain.html" class="external-link">explain</a></code> in package <code>fastshap</code>.</p></dd>


<dt id="arg-visualize">visualize<a class="anchor" aria-label="anchor" href="#arg-visualize"></a></dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, plot the analysis figures.
The default is <code>FALSE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>(<code>VariableAnalysis</code>) A list of</p><ul><li><p>variables (<code>vector</code> of <code>character</code>) The names of environmental variables</p></li>
<li><p>pearson_correlation (<code>tibble</code>) A table of Jackknife test based on Pearson correlation</p></li>
<li><p>full_AUC_ratio (<code>tibble</code>) A table of AUC ratio of training and test dataset using all variables,
that act as references for Jackknife test</p></li>
<li><p>AUC_ratio (<code>tibble</code>) A table of Jackknife test based on AUC ratio</p></li>
<li><p>SHAP (<code>tibble</code>) A table of Shapley values of training and test dataset separately</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><b>Jackknife test</b> of variable importance is reflected as the decrease
in a model performance when an environmental variable is used singly or is
excluded from the environmental variable pool. In this function, we used
Pearson correlation and AUC ratio.</p>
<p><b>Pearson correlation</b> is the correlation between the predictions generated by
different variable importance evaluation methods and the predictions generated
by the full model as the assessment of mode performance.</p>
<p>The area under the ROC curve (AUC) is a threshold-independent evaluator of
model performance, which needs both presence and absence data. A ROC curve is
generated by plotting the proportion of correctly predicted presence on the
y-axis against 1 minus the proportion of correctly predicted absence on x-axis
for all thresholds. Multiple approaches have been used to evaluate accuracy of
presence-only models. Peterson et al. (2008) modified AUC by plotting the
proportion of correctly predicted presence against the proportion of
presences falling above a range of thresholds against the proportion of
cells of the whole area falling above the range of thresholds. This is the
so called <b>AUC ratio</b> that is used in this package.</p>
<p><b>SHapley Additive exPlanations (SHAP)</b> uses Shapley values to evaluate the variable importance. The
larger the absolute value of Shapley value, the more important this variable is.
Positive Shapley values mean positive affect, while negative Shapely values mean
negative affect. Please check references for more details if you are interested in.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Peterson,
A. Townsend, Monica Papeş, and Jorge Soberón. "Rethinking receiver operating
characteristic analysis applications in ecological niche modeling."
<em>Ecological modelling</em> 213.1 (2008): 63-72.<a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008" class="external-link">doi:10.1016/j.ecolmodel.2007.11.008</a></p></li>
<li><p>Strumbelj, Erik,
and Igor Kononenko. "Explaining prediction models and individual predictions
with feature contributions." <em>Knowledge and information systems</em>
41.3 (2014): 647-665.<a href="https://doi.org/10.1007/s10115-013-0679-x" class="external-link">doi:10.1007/s10115-013-0679-x</a></p></li>
<li><p><a href="http://proceedings.mlr.press/v119/sundararajan20b.html" class="external-link">Sundara
rajan, Mukund, and Amir Najmi. "The many Shapley values for model explanation
." <em>International Conference on Machine Learning</em>. PMLR, 2020.</a></p></li>
<li><p><a href="https://github.com/bgreenwell/fastshap" class="external-link">https://github.com/bgreenwell/fastshap</a></p></li>
<li><p><a href="https://github.com/shap/shap" class="external-link">https://github.com/shap/shap</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.VariableAnalysis.html">plot.VariableAnalysis</a></code>, <code><a href="print.VariableAnalysis.html">print.VariableAnalysis</a></code>
<code><a href="https://bgreenwell.github.io/fastshap/reference/explain.html" class="external-link">explain</a></code> in <code>fastshap</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># \donttest{</span></span>
<span><span class="co"># Using a pseudo presence-only occurrence dataset of</span></span>
<span><span class="co"># virtual species provided in this package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LLeiSong/itsdm" class="external-link">itsdm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_virtual_species"</span><span class="op">)</span></span>
<span><span class="va">obs_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"train"</span><span class="op">)</span></span>
<span><span class="va">eval_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"eval"</span><span class="op">)</span></span>
<span><span class="va">x_col</span> <span class="op">&lt;-</span> <span class="st">"x"</span></span>
<span><span class="va">y_col</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="va">obs_col</span> <span class="op">&lt;-</span> <span class="st">"observation"</span></span>
<span></span>
<span><span class="co"># Format the observations</span></span>
<span><span class="va">obs_train_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="format_observation.html">format_observation</a></span><span class="op">(</span></span>
<span>  obs_df <span class="op">=</span> <span class="va">obs_df</span>, eval_df <span class="op">=</span> <span class="va">eval_df</span>,</span>
<span>  x_col <span class="op">=</span> <span class="va">x_col</span>, y_col <span class="op">=</span> <span class="va">y_col</span>, obs_col <span class="op">=</span> <span class="va">obs_col</span>,</span>
<span>  obs_type <span class="op">=</span> <span class="st">"presence_only"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">'extdata/bioclim_tanzania_10min.tif'</span>,</span>
<span>  package <span class="op">=</span> <span class="st">'itsdm'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">'band'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With imperfect_presence mode,</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="isotree_po.html">isotree_po</a></span><span class="op">(</span></span>
<span>  obs_mode <span class="op">=</span> <span class="st">"imperfect_presence"</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">obs</span>,</span>
<span>  obs_ind_eval <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">eval</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">env_vars</span>, ntrees <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">0.8</span>, ndim <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123L</span>, nthreads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  response <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  spatial_response <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_variable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">var_analysis</span> <span class="op">&lt;-</span> <span class="fu">variable_analysis</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">model</span>,</span>
<span>  pts_occ <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">observation</span>,</span>
<span>  pts_occ_test <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">independent_test</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_analysis</span><span class="op">)</span></span>
<span><span class="co"># }</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lei Song.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

