<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Function to evaluate relative importance of each variable. — variable_analysis • itsdm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Function to evaluate relative importance of each variable. — variable_analysis"><meta property="og:description" content="Evaluate relative importance of each variable within the model
using the following methods:
Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables
SHapley Additive exPlanations (SHAP) according to Shapley values

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">itsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction_of_itsdm.html">Introduction of `itsdm` with a virtual species</a>
    </li>
    <li>
      <a href="../articles/itsdm_example.html">Using `itsdm` to a real species: Africa savanna elephant</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/LLeiSong/itsdm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Function to evaluate relative importance of each variable.</h1>
    <small class="dont-index">Source: <a href="https://github.com/LLeiSong/itsdm/blob/HEAD/R/variable_analysis.R" class="external-link"><code>R/variable_analysis.R</code></a></small>
    <div class="hidden name"><code>variable_analysis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Evaluate relative importance of each variable within the model
using the following methods:</p><ul><li><p>Jackknife test based on AUC ratio and Pearson correlation between the
result of model using all variables</p></li>
<li><p>SHapley Additive exPlanations (SHAP) according to Shapley values</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">variable_analysis</span><span class="op">(</span>
  <span class="va">model</span>,
  <span class="va">pts_occ</span>,
  pts_occ_test <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">variables</span>,
  shap_nsim <span class="op">=</span> <span class="fl">100</span>,
  visualize <span class="op">=</span> <span class="cn">FALSE</span>,
  seed <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>model</dt>
<dd><p>(<code>isolation_forest</code>) The extended isolation forest SDM. It could be
the item <code>model</code> of <code>POIsotree</code> made by function <code><a href="isotree_po.html">isotree_po</a></code>.</p></dd>
<dt>pts_occ</dt>
<dd><p>(<code>sf</code>) The <code>sf</code> style table that
include training occurrence locations.</p></dd>
<dt>pts_occ_test</dt>
<dd><p>(<code>sf</code>, or <code>NULL</code>) The <code>sf</code> style
table that include occurrence locations of test.
If <code>NULL</code>, it would be set the same as <code>var_occ</code>. The default is <code>NULL</code>.</p></dd>
<dt>variables</dt>
<dd><p>(<code>stars</code>) The <code>stars</code> of environmental variables. It should have
multiple <code>attributes</code> instead of <code>dims</code>. If you have <code>raster</code> object instead, you
could use <code><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></code> to convert it to <code>stars</code> or use
<code><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></code> directly read source data as a <code>stars</code>.</p></dd>
<dt>shap_nsim</dt>
<dd><p>(<code>integer</code>) The number of Monte Carlo repetitions in SHAP
method to use for estimating each Shapley value. See details in documentation of
function <code><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">explain</a></code> in package <code>fastshap</code>.</p></dd>
<dt>visualize</dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, plot the analysis figures.
The default is <code>FALSE</code>.</p></dd>
<dt>seed</dt>
<dd><p>(<code>integer</code>) The seed for any random progress. The default is <code>10L</code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>(<code>VariableAnalysis</code>) A list of</p><ul><li><p>variables (<code>vector</code> of <code>character</code>) The names of environmental variables</p></li>
<li><p>pearson_correlation (<code>tibble</code>) A table of Jackknife test based on Pearson correlation</p></li>
<li><p>full_AUC_ratio (<code>tibble</code>) A table of AUC ratio of training and test dataset using all variables,
that act as references for Jackknife test</p></li>
<li><p>AUC_ratio (<code>tibble</code>) A table of Jackknife test based on AUC ratio</p></li>
<li><p>SHAP (<code>tibble</code>) A table of Shapley values of training and test dataset separately</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p><b>Jackknife test</b> of variable importance is reflected as the decrease
in a model performance when an environmental variable is used singly or is
excluded from the environmental variable pool. In this function, we used
Pearson correlation and AUC ratio.</p>
<p><b>Pearson correlation</b> is the correlation between the predictions generated by
different variable importance evaluation methods and the predictions generated
by the full model as the assessment of mode performance.</p>
<p>The area under the ROC curve (AUC) is a threshold-independent evaluator of
model performance, which needs both presence and absence data. A ROC curve is
generated by plotting the proportion of correctly predicted presence on the
y-axis against 1 minus the proportion of correctly predicted absence on x-axis
for all thresholds. Multiple approaches have been used to evaluate accuracy of
presence-only models. Peterson et al. (2008) modified AUC by plotting the
proportion of correctly predicted presence against the proportion of
presences falling above a range of thresholds against the proportion of
cells of the whole area falling above the range of thresholds. This is the
so called <b>AUC ratio</b> that is used in this package.</p>
<p><b>SHapley Additive exPlanations (SHAP)</b> uses Shapley values to evaluate the variable importance. The
larger the absolute value of Shapley value, the more important this variable is.
Positive Shapley values mean positive affect, while negative Shapely values mean
negative affect. Please check references for more details if you are interested in.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ul><li><p>Peterson,
A. Townsend, Monica Papeş, and Jorge Soberón. "Rethinking receiver operating
characteristic analysis applications in ecological niche modeling."
<em>Ecological modelling</em> 213.1 (2008): 63-72.doi: <a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008" class="external-link">10.1016/j.ecolmodel.2007.11.008</a></p></li>
<li><p>Strumbelj, Erik,
and Igor Kononenko. "Explaining prediction models and individual predictions
with feature contributions." <em>Knowledge and information systems</em>
41.3 (2014): 647-665.doi: <a href="https://doi.org/10.1007/s10115-013-0679-x" class="external-link">10.1007/s10115-013-0679-x</a></p></li>
<li><p><a href="http://proceedings.mlr.press/v119/sundararajan20b.html" class="external-link">Sundara
rajan, Mukund, and Amir Najmi. "The many Shapley values for model explanation
." <em>International Conference on Machine Learning</em>. PMLR, 2020.</a></p></li>
<li><p><a href="https://github.com/bgreenwell/fastshap" class="external-link">https://github.com/bgreenwell/fastshap</a></p></li>
<li><p><a href="https://github.com/slundberg/shap" class="external-link">https://github.com/slundberg/shap</a></p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="plot.VariableAnalysis.html">plot.VariableAnalysis</a></code>, <code><a href="print.VariableAnalysis.html">print.VariableAnalysis</a></code>
<code><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">explain</a></code> in <code>fastshap</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># \donttest{</span>
<span class="co"># Using a pseudo presence-only occurrence dataset of</span>
<span class="co"># virtual species provided in this package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LLeiSong/itsdm" class="external-link">itsdm</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_virtual_species"</span><span class="op">)</span>
<span class="va">occ_virtual_species</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span>
<span class="va">occ</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_frac</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span>
<span class="va">occ_test</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">occ</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">occ</span> <span class="op">&lt;-</span> <span class="va">occ</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>
<span class="va">occ_test</span> <span class="op">&lt;-</span> <span class="va">occ_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>

<span class="va">env_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>
  <span class="st">'extdata/bioclim_tanzania_10min.tif'</span>,
  package <span class="op">=</span> <span class="st">'itsdm'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">'band'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="isotree_po.html">isotree_po</a></span><span class="op">(</span>
  occ <span class="op">=</span> <span class="va">occ</span>, occ_test <span class="op">=</span> <span class="va">occ_test</span>,
  variables <span class="op">=</span> <span class="va">env_vars</span>, ntrees <span class="op">=</span> <span class="fl">50</span>,
  sample_rate <span class="op">=</span> <span class="fl">0.8</span>, ndim <span class="op">=</span> <span class="fl">2L</span>,
  seed <span class="op">=</span> <span class="fl">123L</span>, response <span class="op">=</span> <span class="cn">FALSE</span>,
  spatial_response <span class="op">=</span> <span class="cn">FALSE</span>,
  check_variable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">var_analysis</span> <span class="op">&lt;-</span> <span class="fu">variable_analysis</span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">model</span>,
  pts_occ <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">pts_occ</span>,
  pts_occ_test <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">pts_occ_test</span>,
  variables <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_analysis</span><span class="op">)</span>
<span class="co"># }</span>

</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lei Song.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

