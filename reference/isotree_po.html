<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Build Isolation forest species distribution model and explain the the model and outputs. — isotree_po • itsdm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build Isolation forest species distribution model and explain the the model and outputs. — isotree_po"><meta name="description" content="Call Isolation forest and its variations to do
species distribution modeling and optionally call a collection of other
functions to do model explanation."><meta property="og:description" content="Call Isolation forest and its variations to do
species distribution modeling and optionally call a collection of other
functions to do model explanation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">itsdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction_of_itsdm.html">Introduction of itsdm with a virtual species</a></li>
    <li><a class="dropdown-item" href="../articles/itsdm_example.html">Using itsdm to a real species: Africa savanna elephant</a></li>
    <li><a class="dropdown-item" href="../articles/shap_application.html">Applications of Shapley values on SDM explanation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LLeiSong/itsdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Build Isolation forest species distribution model and explain the the model and outputs.</h1>
      <small class="dont-index">Source: <a href="https://github.com/LLeiSong/itsdm/blob/main/R/isotree_po.R" class="external-link"><code>R/isotree_po.R</code></a></small>
      <div class="d-none name"><code>isotree_po.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Call Isolation forest and its variations to do
species distribution modeling and optionally call a collection of other
functions to do model explanation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">isotree_po</span><span class="op">(</span></span>
<span>  obs_mode <span class="op">=</span> <span class="st">"imperfect_presence"</span>,</span>
<span>  <span class="va">obs</span>,</span>
<span>  obs_ind_eval <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">variables</span>,</span>
<span>  categ_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contamination <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  ntrees <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ndim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  response <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spatial_response <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check_variable <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  visualize <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obs-mode">obs_mode<a class="anchor" aria-label="anchor" href="#arg-obs-mode"></a></dt>
<dd><p>(<code>string</code>) The mode of observations for training. It should
be one of <code>c("perfect_presence", "imperfect_presence", "presence_absence")</code>.
"perfect_presence" means presence-only occurrences without
errors/uncertainties/bias, which should be rare in reality.
"Imperfect_presence" means presence-only occurrences with
errors/uncertainties/bias, which should be a most common case.
"presence_absence" means presence-absence observations regardless quality.
See details to learn how to set it. The default is "imperfect_presence".</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>(<code>sf</code>) The <code>sf</code> of observation for training. It is recommended to
call function <code><a href="format_observation.html">format_observation</a></code> to format the
occurrence (<code>obs</code>) before passing it here.
Otherwise, make sure there is a column named "observation" for observation.</p></dd>


<dt id="arg-obs-ind-eval">obs_ind_eval<a class="anchor" aria-label="anchor" href="#arg-obs-ind-eval"></a></dt>
<dd><p>(<code>sf</code> or <code>NULL</code>) Optional <code>sf</code> of observations for
independent test. It is recommended to call function
<code><a href="format_observation.html">format_observation</a></code> to format the occurrence (<code>obs</code>)
before passing it here. Otherwise, make sure there is a column named
"observation" for observation.
If <code>NULL</code>, no independent test set will be used. The default is <code>NULL</code>.</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>(<code>RasterStack</code> or <code>stars</code>) The stack of environmental variables.</p></dd>


<dt id="arg-categ-vars">categ_vars<a class="anchor" aria-label="anchor" href="#arg-categ-vars"></a></dt>
<dd><p>(<code>vector</code> of <code>character</code> or <code>NULL</code>) The names of categorical
variables. Must be the same as the names in <code>variables</code>.</p></dd>


<dt id="arg-contamination">contamination<a class="anchor" aria-label="anchor" href="#arg-contamination"></a></dt>
<dd><p>(<code>numeric</code>) The percentage of abnormal cases within a
dataset. Because <code>iForest</code> is an outlier detection algorithm. It picks up
abnormal cases (much fewer) from normal cases. This argument is used to set
how many abnormal cases should be there if the users have the power to control.
See details for how to set it. The value should be less than 0.5. Here we
constrain it in (0, 0.3]. The default value is 0.1.</p></dd>


<dt id="arg-ntrees">ntrees<a class="anchor" aria-label="anchor" href="#arg-ntrees"></a></dt>
<dd><p>(<code>integer</code>) The number of trees for the isolation forest. It must
be integer, which you could use function <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></code> to convert to.
The default is <code>100L</code>.</p></dd>


<dt id="arg-sample-size">sample_size<a class="anchor" aria-label="anchor" href="#arg-sample-size"></a></dt>
<dd><p>(<code>numeric</code>) It should be a rate for sampling size in <code>[0, 1]</code>.
The default is <code>1.0</code>.</p></dd>


<dt id="arg-ndim">ndim<a class="anchor" aria-label="anchor" href="#arg-ndim"></a></dt>
<dd><p>(<code>integer</code>) ExtensionLevel for isolation forest. It must
be integer, which you could use function <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></code> to convert
to. Also, it must be no smaller than the dimension of environmental variables.
When it is 1, the model is a traditional isolation forest, otherwise the model
is an extended isolation forest. The default is 1.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>(<code>integer</code>) The random seed used in the modeling. It should be an
integer. The default is <code>10L</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments that <code><a href="https://rdrr.io/pkg/isotree/man/isolation.forest.html" class="external-link">isolation.forest</a></code> needs.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>(<code>numeric</code>) The offset to adjust fitted suitability. The default
is zero. Highly recommend to leave it as default.</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, generate response curves.
The default is <code>TRUE</code>.</p></dd>


<dt id="arg-spatial-response">spatial_response<a class="anchor" aria-label="anchor" href="#arg-spatial-response"></a></dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, generate spatial response maps.
The default is <code>TRUE</code> because it might be slow. NOTE that here SHAP-based map
is not generated because it is slow. If you want it be mapped, you could call
function <code><a href="spatial_response.html">spatial_response</a></code> to make it.</p></dd>


<dt id="arg-check-variable">check_variable<a class="anchor" aria-label="anchor" href="#arg-check-variable"></a></dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, check the variable importance.
The default is <code>TRUE</code>.</p></dd>


<dt id="arg-visualize">visualize<a class="anchor" aria-label="anchor" href="#arg-visualize"></a></dt>
<dd><p>(<code>logical</code>) If <code>TRUE</code>, generate the essential figures
related to the model. The default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>(<code>POIsotree</code>) A list of</p><ul><li><p>model (<code><a href="https://rdrr.io/pkg/isotree/man/isolation.forest.html" class="external-link">isolation.forest</a></code>) The threshold set in
function inputs</p></li>
<li><p>variables (<code>stars</code>) The formatted image stack of
environmental variables</p></li>
<li><p>observation (<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>) A <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> of training occurrence
dataset</p></li>
<li><p>background_samples (<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>) A <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> of background points
for training dataset evaluation or SHAP dependence plot</p></li>
<li><p>independent_test (<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> or <code>NULL</code>) A <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> of test
occurrence dataset</p></li>
<li><p>background_samples_test (<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> or <code>NULL</code>) A <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> of
background points for test dataset evaluation or SHAP dependence plot</p></li>
<li><p>vars_train (<code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code>) A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> with values of each
environmental variables for training occurrence</p></li>
<li><p>pred_train (<code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code>) A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> with values of
prediction for training occurrence</p></li>
<li><p>eval_train (<code>POEvaluation</code>) A list of presence-only evaluation metrics
based on training dataset. See details of <code>POEvaluation</code> in
<code><a href="evaluate_po.html">evaluate_po</a></code></p></li>
<li><p>var_test (<code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or <code>NULL</code>) A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> with values of each
environmental variables for test occurrence</p></li>
<li><p>pred_test (<code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> or <code>NULL</code>) A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> with values of
prediction for test occurrence</p></li>
<li><p>eval_test (<code>POEvaluation</code> or <code>NULL</code>) A list of presence-only evaluation metrics
based on test dataset.
See details of <code>POEvaluation</code> in <code><a href="evaluate_po.html">evaluate_po</a></code></p></li>
<li><p>prediction (<code>stars</code>) The predicted environmental suitability</p></li>
<li><p>marginal_responses (<code>MarginalResponse</code> or <code>NULL</code>) A list of marginal response
values of each environmental variables.
See details in <code><a href="marginal_response.html">marginal_response</a></code></p></li>
<li><p>offset (<code>numeric</code>) The offset value set as inputs.</p></li>
<li><p>independent_responses (<code>IndependentResponse</code> or <code>NULL</code>) A list of independent
response values of each environmental variables.
See details in <code><a href="independent_response.html">independent_response</a></code></p></li>
<li><p>shap_dependences (<code>ShapDependence</code> or <code>NULL</code>) A list of variable
dependence values of each environmental variables.
See details in <code><a href="shap_dependence.html">shap_dependence</a></code></p></li>
<li><p>spatial_responses (<code>SpatialResponse</code> or <code>NULL</code>) A list of spatial variable
dependence values of each environmental variables.
See details in <code><a href="shap_dependence.html">shap_dependence</a></code></p></li>
<li><p>variable_analysis (<code>VariableAnalysis</code> or <code>NULL</code>) A list of variable importance
analysis based on multiple metrics.
See details in <code><a href="variable_analysis.html">variable_analysis</a></code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For "perfect_presence", a user-defined number (<code>contamination</code>) of samples
will be taken from background to let <code>iForest</code> function normally.</p>
<p>If "imperfect_presence", no further actions is required.</p>
<p>If the <b>obs_mode</b> is "presence_absence", a <code>contamination</code> percent
of absences will be randomly selected and work together with all presences
to train the model.</p>
<p>NOTE: <b>obs_mode</b> and <b>mode</b> only works for <code>obs</code>. <code>obs_ind_eval</code>
will follow its own structure.</p>
<p>Please read details of algorithm <code><a href="https://rdrr.io/pkg/isotree/man/isolation.forest.html" class="external-link">isolation.forest</a></code> on
<a href="https://github.com/david-cortes/isotree" class="external-link">https://github.com/david-cortes/isotree</a>, and
the R documentation of function <code><a href="https://rdrr.io/pkg/isotree/man/isolation.forest.html" class="external-link">isolation.forest</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Liu, Fei
Tony, Kai Ming Ting, and Zhi-Hua Zhou. "Isolation forest."
<em>2008 eighth ieee international conference on data mining</em>.IEEE, 2008.
<a href="https://doi.org/10.1109/ICDM.2008.17" class="external-link">doi:10.1109/ICDM.2008.17</a></p></li>
<li><p>Liu, Fei Tony, Kai Ming
Ting, and Zhi-Hua Zhou. "Isolation-based anomaly detection."
<em>ACM Transactions on Knowledge Discovery from Data (TKDD)</em> 6.1 (2012): 1-39.
<a href="https://doi.org/10.1145/2133360.2133363" class="external-link">doi:10.1145/2133360.2133363</a></p></li>
<li><p>Liu, Fei Tony,
Kai Ming Ting, and Zhi-Hua Zhou. "On detecting clustered anomalies using
SCiForest." <em>Joint European Conference on Machine Learning and
Knowledge Discovery in Databases</em>. Springer, Berlin, Heidelberg, 2010.
<a href="https://doi.org/10.1007/978-3-642-15883-4_18" class="external-link">doi:10.1007/978-3-642-15883-4_18</a></p></li>
<li><p>Ha
riri, Sahand, Matias Carrasco Kind, and Robert J. Brunner. "Extended
isolation forest." <em>IEEE Transactions on Knowledge and Data Engineering (2019)</em>.
<a href="https://doi.org/10.1109/TKDE.2019.2947676" class="external-link">doi:10.1109/TKDE.2019.2947676</a></p></li>
<li><p><a href="https://github.com/david-cortes/isotree" class="external-link">https://github.com/david-cortes/isotree</a></p></li>
<li><p>References of related feature such as response curves and variable importance
will be listed under their own functions</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="evaluate_po.html">evaluate_po</a></code>, <code><a href="marginal_response.html">marginal_response</a></code>,
<code><a href="independent_response.html">independent_response</a></code>, <code><a href="shap_dependence.html">shap_dependence</a></code>,
<code><a href="spatial_response.html">spatial_response</a></code>, <code><a href="variable_analysis.html">variable_analysis</a></code>,
<code><a href="https://rdrr.io/pkg/isotree/man/isolation.forest.html" class="external-link">isolation.forest</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># \donttest{</span></span>
<span><span class="co">########### Presence-absence mode #################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LLeiSong/itsdm" class="external-link">itsdm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load example dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_virtual_species"</span><span class="op">)</span></span>
<span><span class="va">obs_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"train"</span><span class="op">)</span></span>
<span><span class="va">eval_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"eval"</span><span class="op">)</span></span>
<span><span class="va">x_col</span> <span class="op">&lt;-</span> <span class="st">"x"</span></span>
<span><span class="va">y_col</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="va">obs_col</span> <span class="op">&lt;-</span> <span class="st">"observation"</span></span>
<span><span class="va">obs_type</span> <span class="op">&lt;-</span> <span class="st">"presence_absence"</span></span>
<span></span>
<span><span class="co"># Format the observations</span></span>
<span><span class="va">obs_train_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="format_observation.html">format_observation</a></span><span class="op">(</span></span>
<span>  obs_df <span class="op">=</span> <span class="va">obs_df</span>, eval_df <span class="op">=</span> <span class="va">eval_df</span>,</span>
<span>  x_col <span class="op">=</span> <span class="va">x_col</span>, y_col <span class="op">=</span> <span class="va">y_col</span>, obs_col <span class="op">=</span> <span class="va">obs_col</span>,</span>
<span>  obs_type <span class="op">=</span> <span class="va">obs_type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load variables</span></span>
<span><span class="va">env_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">'extdata/bioclim_tanzania_10min.tif'</span>,</span>
<span>  package <span class="op">=</span> <span class="st">'itsdm'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">'band'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modeling</span></span>
<span><span class="va">mod_virtual_species</span> <span class="op">&lt;-</span> <span class="fu">isotree_po</span><span class="op">(</span></span>
<span>  obs_mode <span class="op">=</span> <span class="st">"presence_absence"</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">obs</span>,</span>
<span>  obs_ind_eval <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">eval</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">env_vars</span>, ntrees <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">0.6</span>, ndim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123L</span>, nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="co">## Evaluation based on training dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">eval_train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">eval_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Response curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">marginal_responses</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">independent_responses</span>,</span>
<span>     target_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bio1'</span>, <span class="st">'bio5'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">shap_dependence</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Relationships between target var and related var</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">shap_dependence</span>,</span>
<span>     target_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bio1'</span>, <span class="st">'bio5'</span><span class="op">)</span>,</span>
<span>     related_var <span class="op">=</span> <span class="st">'bio12'</span>, smooth_span <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variable importance</span></span>
<span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">variable_analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_virtual_species</span><span class="op">$</span><span class="va">variable_analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="co">########### Presence-absence mode ##################</span></span>
<span><span class="co"># Load example dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_virtual_species"</span><span class="op">)</span></span>
<span><span class="va">obs_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"train"</span><span class="op">)</span></span>
<span><span class="va">eval_df</span> <span class="op">&lt;-</span> <span class="va">occ_virtual_species</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usage</span> <span class="op">==</span> <span class="st">"eval"</span><span class="op">)</span></span>
<span><span class="va">x_col</span> <span class="op">&lt;-</span> <span class="st">"x"</span></span>
<span><span class="va">y_col</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="va">obs_col</span> <span class="op">&lt;-</span> <span class="st">"observation"</span></span>
<span></span>
<span><span class="co"># Format the observations</span></span>
<span><span class="va">obs_train_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="format_observation.html">format_observation</a></span><span class="op">(</span></span>
<span>  obs_df <span class="op">=</span> <span class="va">obs_df</span>, eval_df <span class="op">=</span> <span class="va">eval_df</span>,</span>
<span>  x_col <span class="op">=</span> <span class="va">x_col</span>, y_col <span class="op">=</span> <span class="va">y_col</span>, obs_col <span class="op">=</span> <span class="va">obs_col</span>,</span>
<span>  obs_type <span class="op">=</span> <span class="st">"presence_only"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modeling with perfect_presence mode</span></span>
<span><span class="va">mod_perfect_pres</span> <span class="op">&lt;-</span> <span class="fu">isotree_po</span><span class="op">(</span></span>
<span>  obs_mode <span class="op">=</span> <span class="st">"perfect_presence"</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">obs</span>,</span>
<span>  obs_ind_eval <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">eval</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">env_vars</span>, ntrees <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">0.6</span>, ndim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123L</span>, nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modeling with imperfect_presence mode</span></span>
<span><span class="va">mod_imperfect_pres</span> <span class="op">&lt;-</span> <span class="fu">isotree_po</span><span class="op">(</span></span>
<span>  obs_mode <span class="op">=</span> <span class="st">"imperfect_presence"</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">obs</span>,</span>
<span>  obs_ind_eval <span class="op">=</span> <span class="va">obs_train_eval</span><span class="op">$</span><span class="va">eval</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">env_vars</span>, ntrees <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">0.6</span>, ndim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123L</span>, nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># }</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lei Song.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

